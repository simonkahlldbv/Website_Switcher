<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>3D Vergleich</title>
<style>
    body {
        margin: 0;
        overflow: hidden;
        background: white;
        font-family: Arial, sans-serif;
    }

    #zurueckBtn {
        position: fixed;
        top: 20px;
        left: 20px;
        z-index: 30;
        padding: 10px 20px;
        background: #222;
        color: white;
        border-radius: 8px;
        cursor: pointer;
    }

    /* Die beiden Model-Container liegen exakt übereinander! */
    #viewerContainer {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
    }

    canvas {
        position: absolute;
        top: 0;
        left: 0;
    }

    #modelA {
        z-index: 5;
    }

    #modelB {
        z-index: 6;
        /* Anfangs wird Modell B rechts angezeigt */
        clip-path: inset(0 0 0 50%);
    }

    /* Slider */
    #slider {
        position: absolute;
        top: 0;
        left: 50%;
        width: 4px;
        height: 100%;
        background: red;
        z-index: 20;
        cursor: ew-resize;
    }

    /* Jahr-Buttons links und rechts */
    .yearList {
        position: fixed;
        top: 20%;
        display: flex;
        flex-direction: column;
        gap: 12px;
        z-index: 40;
    }

    #leftYears { left: 20px; }
    #rightYears { right: 20px; }

    .yearBtn {
        background: #222;
        color: white;
        padding: 8px 12px;
        border-radius: 6px;
        cursor: pointer;
        text-align: center;
        width: 60px;
    }
</style>
</head>
<body>

<div id="zurueckBtn">← Zurück</div>

<!-- Jahr-Listen -->
<div id="leftYears" class="yearList"></div>
<div id="rightYears" class="yearList"></div>

<!-- 3D Bereich -->
<div id="viewerContainer">
    <canvas id="modelA"></canvas>
    <canvas id="modelB"></canvas>
</div>

<!-- Slider -->
<div id="slider"></div>

<script type="module">
import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.153/build/three.module.js';
import { OrbitControls } from 'https://cdn.jsdelivr.net/npm/three@0.153/examples/jsm/controls/OrbitControls.js';
import { GLTFLoader } from 'https://cdn.jsdelivr.net/npm/three@0.153/examples/jsm/loaders/GLTFLoader.js';

/* -------------------------------
   MODEL-NAMEN
----------------------------------*/
const years = ["1150","1175","1374","1550","1630","1936"];

const leftYearsDiv = document.getElementById("leftYears");
const rightYearsDiv = document.getElementById("rightYears");

years.forEach(y=>{
    let l = document.createElement("div");
    l.className = "yearBtn";
    l.innerText = y;
    l.onclick = () => loadModel(modelA_scene, y);
    leftYearsDiv.appendChild(l);

    let r = document.createElement("div");
    r.className = "yearBtn";
    r.innerText = y;
    r.onclick = () => loadModel(modelB_scene, y);
    rightYearsDiv.appendChild(r);
});

/* -------------------------------
   ZURÜCK BUTTON (optional)
----------------------------------*/
document.getElementById("zurueckBtn").onclick = () => {
    window.location.reload();
};

/* -------------------------------
   THREE.js SETUP für zwei Modelle
----------------------------------*/

let width = window.innerWidth;
let height = window.innerHeight;

// Zwei komplette Szenen
let modelA_scene = new THREE.Scene();
let modelB_scene = new THREE.Scene();

let camera = new THREE.PerspectiveCamera(50, width/height, 0.1, 5000);
camera.position.set(0, 80, 300);

// Renderer A
let rendererA = new THREE.WebGLRenderer({canvas: document.getElementById("modelA"), antialias:true});
rendererA.setSize(width, height);
rendererA.setPixelRatio(window.devicePixelRatio);

// Renderer B
let rendererB = new THREE.WebGLRenderer({canvas: document.getElementById("modelB"), antialias:true});
rendererB.setSize(width, height);
rendererB.setPixelRatio(window.devicePixelRatio);

// Gemeinsame Controls (für beide identisch!)
let controls = new OrbitControls(camera, rendererA.domElement);
controls.enableDamping = true;

// Gleiche Steuerung auch für Modell B
controls.addEventListener("change", () => {
    rendererB.render(modelB_scene, camera);
});

// Licht in beiden Szenen
function addLights(scene){
    scene.add(new THREE.AmbientLight(0xffffff, 1));
    let d = new THREE.DirectionalLight(0xffffff, 1);
    d.position.set(100,200,100);
    scene.add(d);
}
addLights(modelA_scene);
addLights(modelB_scene);

// Loader
const loader = new GLTFLoader();

/* -------------------------------
   MODEL LADEN
----------------------------------*/
function loadModel(targetScene, year){
    loader.load(year + ".glb", gltf => {

        // Alte Modelle entfernen
        while(targetScene.children.length > 0){
            targetScene.remove(targetScene.children[0]);
        }

        let model = gltf.scene;
        model.rotation.x = -Math.PI/2;
        model.position.set(0,0,0);
        targetScene.add(model);
    });
}

// Standardmäßig erstes Modell laden
loadModel(modelA_scene, "1150");
loadModel(modelB_scene, "1175");

/* -------------------------------
   ANIMATION / RENDER
----------------------------------*/
function animate(){
    requestAnimationFrame(animate);
    controls.update();
    rendererA.render(modelA_scene, camera);
    rendererB.render(modelB_scene, camera);
}
animate();

/* -------------------------------
   SLIDER FUNKTION
----------------------------------*/
const slider = document.getElementById("slider");
let dragging = false;

slider.onmousedown = () => dragging = true;
window.onmouseup = () => dragging = false;

window.onmousemove = e => {
    if(!dragging) return;

    let x = e.clientX;
    if(x < 0) x = 0;
    if(x > window.innerWidth) x = window.innerWidth;

    // Slider verschieben
    slider.style.left = x + "px";

    // Clip Mask für Modell B
    let percent = (x / window.innerWidth) * 100;
    document.getElementById("modelB").style.clipPath = `inset(0 0 0 ${percent}%)`;
};

</script>
</body>
</html>
