<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8" />
<title>3D Modellvergleich</title>

<script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>

<style>
  :root {
    --sidebar-width: 220px;
    --accent: #0077ff;
  }

  html,body{
    height:100%;
    margin:0;
    font-family: Arial, sans-serif;
    background:#f6f6f6;
  }

  /* SIDEBAR */
  #sidebar{
    position:fixed;
    left:0;
    top:0;
    bottom:0;
    width:var(--sidebar-width);
    padding:20px;
    background:#1e1e1e;
    color:white;
    overflow:auto;
    z-index:50;
  }

  .year-btn{
    display:block;
    width:100%;
    padding:10px;
    margin:8px 0;
    background:#333;
    color:white;
    border:0;
    border-radius:6px;
    cursor:pointer;
    text-align:left;
  }

  #compare-btn{
    margin-top:20px;
    width:100%;
    padding:12px;
    background:var(--accent);
    color:white;
    border:0;
    border-radius:6px;
    cursor:pointer;
    font-weight:600;
  }

  /* MAIN AREA */
  #main-area{
    position:fixed;
    left:var(--sidebar-width);
    right:0;
    top:0;
    bottom:0;
    display:flex;
    justify-content:center;
    align-items:center;
    background:#eaeaea;
  }
  #main-model{
    width:80%;
    height:80%;
  }

  /* COMPARE MODE */
  #compare-wrapper{
    display:none;
    position:fixed;
    left:var(--sidebar-width);
    top:0;
    width:calc(100% - var(--sidebar-width));
    height:100%;
    background:white;
    z-index:1000;
  }

  #compare-back{
    position:absolute;
    top:15px;
    left:15px;
    padding:10px 14px;
    background:black;
    color:white;
    border:0;
    border-radius:6px;
    cursor:pointer;
    z-index:2000;
  }

  .side-list{
    position:absolute;
    top:50%;
    transform:translateY(-50%);
    display:flex;
    flex-direction:column;
    gap:10px;
    z-index:2000;
  }

  #left-list{ left:20px; }
  #right-list{ right:20px; }

  #compare-container{
    position:absolute;
    inset:0;
    overflow:hidden;
  }

  model-viewer.compare-model{
    position:absolute;
    inset:0;
    width:100%;
    height:100%;
    pointer-events:auto;
    --poster-color: transparent;
  }

  /* Slider */
  #compare-slider{
    position:absolute;
    top:0;
    height:100%;
    width:6px;
    background:#ff4444;
    border-radius:3px;
    cursor:ew-resize;
    z-index:3000;
  }
</style>
</head>
<body>

<!-- Sidebar -->
<div id="sidebar">
  <h2>Modelle</h2>
  <div id="year-list"></div>
  <button id="compare-btn">Vergleichen</button>
</div>

<!-- Main -->
<div id="main-area">
  <model-viewer id="main-model" camera-controls interaction-prompt="none" interaction-prompt-threshold="0"></model-viewer>
</div>

<!-- Compare Overlay -->
<div id="compare-wrapper">
  <button id="compare-back">← Zurück</button>

  <div id="left-list" class="side-list"></div>
  <div id="right-list" class="side-list"></div>

  <div id="compare-container">
    <model-viewer id="model-left" class="compare-model" camera-controls interaction-prompt="none"></model-viewer>
    <model-viewer id="model-right" class="compare-model" camera-controls interaction-prompt="none"></model-viewer>
  </div>

  <div id="compare-slider"></div>
</div>

<script>
/* MODELS */
const MODEL_LIST = [
  "1150.glb",
  "1175.glb",
  "1374.glb",
  "1550.glb",
  "1630.glb",
  "1936.glb"
];

/* populate list */
const mainViewer = document.getElementById("main-model");
const yearList = document.getElementById("year-list");
MODEL_LIST.forEach(fn=>{
  let b=document.createElement("button");
  b.className="year-btn";
  b.textContent=fn.replace(".glb","");
  b.onclick=()=> mainViewer.src=fn;
  yearList.appendChild(b);
});
mainViewer.src = MODEL_LIST[0];

/* compare UI */
const compareWrapper = document.getElementById("compare-wrapper");
const compareBtn = document.getElementById("compare-btn");
const compareBack = document.getElementById("compare-back");
const leftList = document.getElementById("left-list");
const rightList = document.getElementById("right-list");
const modelLeft = document.getElementById("model-left");
const modelRight = document.getElementById("model-right");
const slider = document.getElementById("compare-slider");
const container = document.getElementById("compare-container");

/* list builder */
function buildLists(){
  leftList.innerHTML="";
  rightList.innerHTML="";
  MODEL_LIST.forEach(fn=>{
    let name=fn.replace(".glb","");
    let L=document.createElement("button");
    L.textContent=name;
    L.onclick=()=>{ modelLeft.src=fn; };
    leftList.appendChild(L);

    let R=document.createElement("button");
    R.textContent=name;
    R.onclick=()=>{ modelRight.src=fn; };
    rightList.appendChild(R);
  });
}

/* open compare */
compareBtn.onclick = ()=>{
  buildLists();
  compareWrapper.style.display="block";
  modelLeft.src = MODEL_LIST[0];
  modelRight.src = MODEL_LIST[MODEL_LIST.length-1];

  requestAnimationFrame(()=> positionSlider(0.5));
};

/* close compare */
compareBack.onclick = ()=> compareWrapper.style.display="none";

/* --- Vertical SLIDER with clip-path --- */
function positionSlider(percent){
  const rect = container.getBoundingClientRect();
  const x = percent * rect.width;
  slider.style.left = x + "px";

  modelLeft.style.clipPath = `inset(0 ${rect.width - x}px 0 0)`;
  modelRight.style.clipPath = `inset(0 0 0 ${x}px)`;
}

let dragging=false;
slider.onmousedown = ()=> dragging=true;
window.onmouseup = ()=> dragging=false;

window.onmousemove = (e)=>{
  if(!dragging) return;
  const rect = container.getBoundingClientRect();
  let x = e.clientX - rect.left;
  x = Math.max(20, Math.min(rect.width-20, x));  
  positionSlider(x / rect.width);
};

/* ---- CAMERA SYNC (correct & stable) ---- */
let syncing=false;

function syncCam(source, target){
  if(syncing) return;
  syncing=true;
  try{
    target.cameraOrbit = source.cameraOrbit;
    target.cameraTarget = source.cameraTarget;
    target.fieldOfView = source.fieldOfView;
  }catch(e){}
  setTimeout(()=> syncing=false,0);
}

modelLeft.addEventListener("camera-change", ()=> syncCam(modelLeft, modelRight));
modelRight.addEventListener("camera-change", ()=> syncCam(modelRight, modelLeft));
</script>
</body>
</html>
