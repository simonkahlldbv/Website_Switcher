<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8" />
<title>3D Modellvergleich</title>

<!-- model-viewer -->
<script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>

<style>
  :root {
    --sidebar-width: 220px;
    --accent: #0077ff;
  }

  html,body{
    height:100%;
    margin:0;
    font-family: Arial, sans-serif;
    background: #f6f6f6;
  }

  /* SIDEBAR */
  #sidebar{
    position:fixed;
    left:0;
    top:0;
    bottom:0;
    width:var(--sidebar-width);
    padding:20px;
    box-sizing:border-box;
    background:#1e1e1e;
    color:white;
    overflow:auto;
    z-index:50;
  }

  #sidebar h2 { margin:0 0 12px 0; font-size:18px; }
  .year-btn{
    display:block;
    width:100%;
    padding:10px;
    margin:8px 0;
    background:#333;
    color:white;
    border:0;
    border-radius:6px;
    cursor:pointer;
    text-align:left;
    font-size:15px;
  }
  .year-btn:hover{ background:#444; }

  #compare-btn {
    margin-top:18px;
    display:block;
    width:100%;
    padding:12px;
    background:var(--accent);
    color:white;
    border:0;
    border-radius:8px;
    cursor:pointer;
    font-weight:600;
    font-size:15px;
  }
  #compare-btn:hover{ filter:brightness(.95); }

  /* MAIN VIEW */
  #main-area{
    position:fixed;
    left:var(--sidebar-width);
    top:0;
    right:0;
    bottom:0;
    display:flex;
    align-items:center;
    justify-content:center;
    background:#eaeaea;
  }

  model-viewer#main-model{
    width:80%;
    height:80%;
    --poster-color: transparent;
  }

  /* COMPARE MODE (OVERLAY) */
  #compare-wrapper{
    display:none;
    position:fixed;
    left:var(--sidebar-width);
    top:0;
    width:calc(100vw - var(--sidebar-width));
    height:100vh;
    background:white;
    z-index:1000;
    overflow:hidden;
  }

  #compare-back {
    position:absolute;
    top:16px;
    left:16px;
    z-index:2000;
    padding:10px 14px;
    background:#000;
    color:#fff;
    border:0;
    border-radius:6px;
    cursor:pointer;
  }

  .side-list {
    position:absolute;
    top:50%;
    transform:translateY(-50%);
    display:flex;
    flex-direction:column;
    gap:10px;
    z-index:2000;
    width:160px;
  }
  #left-list { left:20px; }
  #right-list { right:20px; text-align:right; }

  .side-list button {
    padding:8px 10px;
    background:#222;
    color:#fff;
    border:0;
    border-radius:6px;
    cursor:pointer;
  }
  .side-list button:hover{ background:#444; }

  /* OVERLAYED MODELS */
  #compare-container{
    position:absolute;
    inset:0;
    overflow:hidden;
  }

  model-viewer.compare-model {
    position:absolute;
    inset:0;
    width:100%;
    height:100%;
    pointer-events:auto;
    --poster-color: transparent;
  }

  #model-right {
    opacity:1; /* wird durch slider verändert */
    transition: opacity 0.15s linear;
  }

  /* opacity slider */
  #opacity-slider {
    position:absolute;
    bottom:30px;
    left:50%;
    transform:translateX(-50%);
    width:40%;
    height:4px;
    z-index:2000;
  }

  model-viewer::part(default-controls){
    display:none !important;
  }
</style>
</head>
<body>

  <!-- Sidebar -->
  <div id="sidebar">
    <h2>Modelle</h2>
    <div id="year-list"></div>

    <button id="compare-btn">Vergleichen</button>
  </div>

  <!-- Main area -->
  <div id="main-area">
    <model-viewer id="main-model"
      camera-controls
      interaction-prompt="none"
      interaction-prompt-threshold="0"
      alt="Hauptmodell">
    </model-viewer>
  </div>

  <!-- Compare overlay -->
  <div id="compare-wrapper">
    <button id="compare-back">← Zurück</button>

    <div id="left-list" class="side-list"></div>
    <div id="right-list" class="side-list"></div>

    <div id="compare-container">
      <model-viewer id="model-left" class="compare-model"
        camera-controls
        interaction-prompt="none"
        interaction-prompt-threshold="0">
      </model-viewer>

      <model-viewer id="model-right" class="compare-model"
        camera-controls
        interaction-prompt="none"
        interaction-prompt-threshold="0">
      </model-viewer>
    </div>

    <!-- Opacity Slider -->
    <input id="opacity-slider" type="range" min="0" max="1" step="0.01" value="0.5">
  </div>

<script>
/* ===========================
   Models
   =========================== */
const MODEL_LIST = [
  "1150.glb",
  "1175.glb",
  "1374.glb",
  "1550.glb",
  "1630.glb",
  "1936.glb"
];

/* Populate sidebar */
const mainViewer = document.getElementById("main-model");
const yearList = document.getElementById('year-list');

MODEL_LIST.forEach(fn => {
  const name = fn.replace(/\.glb$/,'');
  const btn = document.createElement("button");
  btn.className = "year-btn";
  btn.textContent = name;
  btn.onclick = () => { mainViewer.src = fn; };
  yearList.appendChild(btn);
});

mainViewer.src = MODEL_LIST[0];

/* compare mode */
const compareWrapper = document.getElementById("compare-wrapper");
const compareBtn = document.getElementById("compare-btn");
const compareBack = document.getElementById("compare-back");
const leftList = document.getElementById("left-list");
const rightList = document.getElementById("right-list");
const modelLeft = document.getElementById("model-left");
const modelRight = document.getElementById("model-right");
const opacitySlider = document.getElementById("opacity-slider");

function buildLists(){
  leftList.innerHTML = "";
  rightList.innerHTML = "";

  MODEL_LIST.forEach(fn => {
    const name = fn.replace(/\.glb$/,'');

    const bl = document.createElement("button");
    bl.textContent = name;
    bl.onclick = () => { modelLeft.src = fn; };
    leftList.appendChild(bl);

    const br = document.createElement("button");
    br.textContent = name;
    br.onclick = () => { modelRight.src = fn; };
    rightList.appendChild(br);
  });
}

compareBtn.onclick = () => {
  buildLists();
  compareWrapper.style.display = "block";

  modelLeft.src = MODEL_LIST[0];
  modelRight.src = MODEL_LIST[MODEL_LIST.length-1];
};

compareBack.onclick = () => {
  compareWrapper.style.display = "none";
};

/* opacity blend */
opacitySlider.oninput = () => {
  modelRight.style.opacity = opacitySlider.value;
};

/* ---- CAMERA SYNC ---- */
let syncing = false;

function sync(source, target){
  if(syncing) return;
  syncing = true;

  try {
    target.cameraOrbit = source.cameraOrbit;
    target.cameraTarget = source.cameraTarget;
    target.fieldOfView = source.fieldOfView;
  } catch(e){}

  setTimeout(()=> syncing=false,0);
}

modelLeft.addEventListener("camera-change",()=>sync(modelLeft,modelRight));
modelRight.addEventListener("camera-change",()=>sync(modelRight,modelLeft));

</script>
</body>
</html>
