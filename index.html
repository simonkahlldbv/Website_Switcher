<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8" />
<title>3D Modellvergleich</title>

<!-- model-viewer -->
<script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>

<style>
  :root {
    --sidebar-w: 220px;
    --accent: #0077ff;
  }
  html,body{height:100%;margin:0;font-family:Arial, sans-serif;background:#f6f6f6;}

/* SIDEBAR */
#sidebar{
  position:fixed; left:0; top:0; bottom:0;
  width:var(--sidebar-w); padding:20px; box-sizing:border-box;
  background:#1e1e1e; color:#fff; overflow:auto; z-index:60;
}
#sidebar h2{margin:0 0 12px 0}
.year-btn{
  display:block; width:100%; padding:10px; margin:8px 0;
  background:#333; color:#fff; border:0; border-radius:6px; cursor:pointer;
  text-align:left; font-size:15px;
}
.year-btn:hover{background:#444}
#compare-btn{
  margin-top:18px; width:100%; padding:12px; background:var(--accent);
  color:#fff; border:0; border-radius:8px; cursor:pointer; font-weight:600;
}

/* MAIN */
#main-area{
  position:fixed; left:var(--sidebar-w); right:0; top:0; bottom:0;
  display:flex; align-items:center; justify-content:center; background:#eaeaea; z-index:10;
}
model-viewer#main-model{ width:80%; height:80%; --poster-color:transparent; }

/* COMPARE OVERLAY */
#compare-overlay{
  display:none; position:fixed;
  left:var(--sidebar-w); top:0;
  width:calc(100vw - var(--sidebar-w)); height:100vh;
  background:#fff; z-index:200; overflow:hidden;
}

/* back button */
#compare-back{
  position:absolute; top:14px; left:14px; z-index:400;
  padding:10px 14px; background:#000; color:#fff; border:0; border-radius:6px; cursor:pointer;
}

/* side lists */
.side-list{
  position:absolute; top:50%; transform:translateY(-50%);
  display:flex; flex-direction:column; gap:10px; z-index:400; width:140px;
}
#left-list{ left:20px }
#right-list{ right:20px; text-align:right }
.side-list button{ padding:8px 10px; background:#222; color:#fff; border:0; border-radius:6px; cursor:pointer }
.side-list button:hover{ background:#444 }

/* compare container: both viewers exactly overlapping */
#compare-container{ position:absolute; inset:0; overflow:hidden; }
model-viewer.compare{
  position:absolute; inset:0; width:100%; height:100%;
  --poster-color:transparent; pointer-events:auto; touch-action:none;
}

/* initial clip: left viewer shows left half, right viewer shows right half */
#viewer-left{ z-index:100; clip-path: inset(0 calc(50%) 0 0); }
#viewer-right{ z-index:110; clip-path: inset(0 0 0 calc(50%)); }

/* vertical slider */
#slider{
  position:absolute; top:0; height:100%; width:6px; background:#ff3b3b;
  left:50%; transform:translateX(-50%); z-index:350; cursor:ew-resize; border-radius:3px;
}

/* hide model-viewer default UI parts */
model-viewer::part(default-controls){ display:none !important; }
</style>
</head>
<body>

  <!-- SIDEBAR -->
  <div id="sidebar">
    <h2>Modelle</h2>
    <div id="year-list"></div>
    <button id="compare-btn">Vergleichen</button>
  </div>

  <!-- MAIN -->
  <div id="main-area">
    <model-viewer id="main-model"
      camera-controls
      interaction-prompt="none"
      interaction-prompt-threshold="0"
      alt="Hauptmodell"></model-viewer>
  </div>

  <!-- COMPARE OVERLAY -->
  <div id="compare-overlay" aria-hidden="true">
    <button id="compare-back">← Zurück</button>

    <div id="left-list" class="side-list"></div>
    <div id="right-list" class="side-list"></div>

    <div id="compare-container">
      <model-viewer id="viewer-left" class="compare"
        camera-controls
        interaction-prompt="none"
        interaction-prompt-threshold="0"
        alt="linkes Modell"></model-viewer>

      <model-viewer id="viewer-right" class="compare"
        camera-controls
        interaction-prompt="none"
        interaction-prompt-threshold="0"
        alt="rechtes Modell"></model-viewer>
    </div>

    <div id="slider" role="separator" aria-orientation="vertical"></div>
  </div>

<script>
/* ===========================
   Konfiguration: Dateinamen
   =========================== */
const MODEL_LIST = [
  "1150.glb",
  "1175.glb",
  "1374.glb",
  "1550.glb",
  "1630.glb",
  "1936.glb"
];

/* ---------- Sidebar (Normalmodus) ---------- */
const yearList = document.getElementById('year-list');
const mainModel = document.getElementById('main-model');

MODEL_LIST.forEach(fn=>{
  const label = fn.replace(/\.glb$/i,'');
  const b = document.createElement('button');
  b.className = 'year-btn';
  b.textContent = label;
  b.onclick = () => { mainModel.src = fn; };
  yearList.appendChild(b);
});
// show first model immediately
mainModel.src = MODEL_LIST[0];

/* ---------- Compare UI refs ---------- */
const compareBtn = document.getElementById('compare-btn');
const compareOverlay = document.getElementById('compare-overlay');
const compareBack = document.getElementById('compare-back');
const leftList = document.getElementById('left-list');
const rightList = document.getElementById('right-list');
const viewerLeft = document.getElementById('viewer-left');
const viewerRight = document.getElementById('viewer-right');
const slider = document.getElementById('slider');
const compareContainer = document.getElementById('compare-container');

let currentPct = 0.5; // slider percent (0..1)

/* Build compare lists */
function buildCompareLists(){
  leftList.innerHTML = ''; rightList.innerHTML = '';
  MODEL_LIST.forEach(fn=>{
    const lbl = fn.replace(/\.glb$/i,'');
    const bl = document.createElement('button');
    bl.textContent = lbl;
    bl.onclick = ()=> viewerLeft.src = fn;
    leftList.appendChild(bl);

    const br = document.createElement('button');
    br.textContent = lbl;
    br.onclick = ()=> viewerRight.src = fn;
    rightList.appendChild(br);
  });
}

/* open compare */
compareBtn.addEventListener('click', ()=>{
  buildCompareLists();
  compareOverlay.style.display = 'block';
  compareOverlay.setAttribute('aria-hidden','false');

  // default models if empty
  if(!viewerLeft.src) viewerLeft.src = MODEL_LIST[0];
  if(!viewerRight.src) viewerRight.src = MODEL_LIST[MODEL_LIST.length-1];

  // center slider
  requestAnimationFrame(()=> setSliderPercent(0.5));
});

/* close compare */
compareBack.addEventListener('click', ()=>{
  compareOverlay.style.display = 'none';
  compareOverlay.setAttribute('aria-hidden','true');
});

/* -------------------------
   Slider: drag & touch handling
   ------------------------- */
let dragging = false;

slider.addEventListener('mousedown', (e)=> { e.preventDefault(); dragging = true; });
window.addEventListener('mouseup', ()=> dragging = false);
window.addEventListener('mouseleave', ()=> dragging = false);
window.addEventListener('mousemove', (e)=> { if(!dragging) return; updateFromClientX(e.clientX); });

slider.addEventListener('touchstart', (e)=> { e.preventDefault(); dragging = true; });
window.addEventListener('touchend', ()=> dragging = false);
window.addEventListener('touchcancel', ()=> dragging = false);
window.addEventListener('touchmove', (e)=> { if(!dragging) return; updateFromClientX(e.touches[0].clientX); });

function updateFromClientX(clientX){
  const rect = compareContainer.getBoundingClientRect();
  const leftBound = rect.left + 6;
  const rightBound = rect.right - 6;
  const clamped = Math.min(Math.max(clientX, leftBound), rightBound);
  const x = clamped - rect.left;
  const pct = rect.width ? (x/rect.width) : 0.5;
  setSliderPercent(pct);
}

function setSliderPercent(pct){
  pct = Math.max(0.01, Math.min(0.99, pct));
  currentPct = pct;
  const rect = compareContainer.getBoundingClientRect();
  const x = pct * rect.width;
  // Position slider relative to overlay (use page coords for left)
  const overlayRect = compareOverlay.getBoundingClientRect();
  slider.style.left = (overlayRect.left + x) + 'px';
  // Set clip-paths on viewers using px values relative to container width
  viewerLeft.style.clipPath = `inset(0 ${Math.round(rect.width - x)}px 0 0)`;
  viewerRight.style.clipPath = `inset(0 0 0 ${Math.round(x)}px)`;
}

/* keep slider position on resize */
window.addEventListener('resize', ()=>{
  setTimeout(()=> setSliderPercent(currentPct), 10);
});

/* -------------------------
   Camera sync (bidirectional, stable)
   ------------------------- */
let syncing = false;
function copyCamera(source, target){
  if(syncing) return;
  syncing = true;
  try {
    // copy cameraOrbit, cameraTarget and fieldOfView if available
    if(source.cameraOrbit) target.cameraOrbit = source.cameraOrbit;
    if(source.cameraTarget) target.cameraTarget = source.cameraTarget;
    if(typeof source.fieldOfView !== 'undefined') target.fieldOfView = source.fieldOfView;
  } catch(e){}
  // small timeout to break potential event loops
  setTimeout(()=> syncing = false, 0);
}

// listen to camera-change from both viewers
viewerLeft.addEventListener('camera-change', ()=> copyCamera(viewerLeft, viewerRight));
viewerRight.addEventListener('camera-change', ()=> copyCamera(viewerRight, viewerLeft));

/* Ensure viewers start still (avoid preview motion) by setting an initial orbit after load */
function setInitial(viewer){
  try {
    const initial = '0deg 75deg 2.5m';
    viewer.cameraOrbit = initial;
    viewer.cameraTarget = '0m 0m 0m';
  } catch(e){}
}
viewerLeft.addEventListener('load', ()=> setInitial(viewerLeft));
viewerRight.addEventListener('load', ()=> setInitial(viewerRight));

/* Optional: ESC closes overlay */
window.addEventListener('keydown', (e)=>{
  if(e.key === 'Escape' && compareOverlay.style.display === 'block') compareOverlay.style.display = 'none';
});
</script>

</body>
</html>