<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8" />
<title>3D Modellvergleich</title>

<!-- THREE.js + orbit controls -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r152/three.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r152/examples/js/controls/OrbitControls.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r152/examples/js/loaders/GLTFLoader.js"></script>

<style>
html, body {
  margin: 0;
  padding: 0;
  overflow: hidden;
  font-family: Arial, sans-serif;
}

/* SIDEBAR LEFT */
#sidebar {
  position: fixed;
  top: 0;
  left: 0;
  width: 220px;
  height: 100vh;
  background: #1e1e1e;
  color: #fff;
  padding: 20px;
  z-index: 20;
  overflow-y: auto;
}
.year-btn {
  width: 100%;
  padding: 10px;
  margin: 6px 0;
  background: #333;
  border: 0;
  border-radius: 6px;
  color: #fff;
  cursor: pointer;
  text-align: left;
}
.year-btn:hover { background:#444; }

#compare-btn {
  width: 100%;
  margin-top: 20px;
  padding: 12px;
  background: #0077ff;
  border: 0;
  border-radius: 8px;
  color: white;
  cursor: pointer;
  font-weight: bold;
}

/* MAIN VIEW */
#main-canvas {
  position: absolute;
  left: 220px;
  top: 0;
  right: 0;
  bottom: 0;
  background: #eaeaea;
}

/* COMPARE MODE */
#compare-wrapper {
  display: none;
  position: fixed;
  left: 220px;
  top: 0;
  right: 0;
  bottom: 0;
  background: white;
  z-index: 99;
}

/* back button */
#compare-back {
  position: absolute;
  top: 15px;
  left: 15px;
  padding: 10px 14px;
  background: black;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  z-index: 200;
}

/* LEFT+RIGHT YEAR LISTS IN COMPARE MODE */
.side-list {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  display: flex;
  flex-direction: column;
  gap: 10px;
  z-index: 200;
}
#left-list  { left: 20px; }
#right-list { right: 20px; text-align: right; }

.side-list button {
  padding: 8px 10px;
  background: #222;
  border: 0;
  border-radius: 6px;
  color: white;
  cursor: pointer;
}
.side-list button:hover { background:#444; }

/* The TWO CANVASES stacked */
.compare-canvas {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  z-index: 50;
  display: block;
}

/* clipping for left + right half */
#canvas-left  { clip-path: inset(0 50% 0 0); }
#canvas-right { clip-path: inset(0 0 0 50%); }

/* vertical slider */
#compare-slider {
  position: absolute;
  top: 0;
  width: 6px;
  height: 100%;
  background: red;
  z-index: 150;
  cursor: ew-resize;
  left: 50%;
  transform: translateX(-3px);
  border-radius: 3px;
}
</style>
</head>

<body>

<!-- SIDEBAR -->
<div id="sidebar">
  <h2>Modelle</h2>

  <div id="year-list"></div>
  <button id="compare-btn">Vergleichen</button>
</div>

<!-- MAIN VIEW CANVAS -->
<canvas id="main-canvas"></canvas>

<!-- COMPARE MODE -->
<div id="compare-wrapper">

  <button id="compare-back">← Zurück</button>

  <div id="left-list"  class="side-list"></div>
  <div id="right-list" class="side-list"></div>

  <canvas id="canvas-left"  class="compare-canvas"></canvas>
  <canvas id="canvas-right" class="compare-canvas"></canvas>

  <div id="compare-slider"></div>
</div>


<script>
/* ===========================
   MODEL FILENAMES
   =========================== */
const MODELS = [
  "1150.glb",
  "1175.glb",
  "1374.glb",
  "1550.glb",
  "1630.glb",
  "1936.glb"
];

/* ===========================
   CREATE MODEL BUTTONS
   =========================== */
const yearList = document.getElementById("year-list");
MODELS.forEach(name => {
  const btn = document.createElement("button");
  btn.className = "year-btn";
  btn.textContent = name.replace(".glb", "");
  btn.onclick = () => loadMainModel(name);
  yearList.appendChild(btn);
});

/* ===========================
   MAIN VIEW (single model)
   =========================== */

let mainRenderer, mainScene, mainCamera, mainControls, mainModel;
initMainView();
loadMainModel(MODELS[0]); // start with first

function initMainView() {
  const canvas = document.getElementById("main-canvas");
  mainRenderer = new THREE.WebGLRenderer({ canvas, antialias: true });
  mainRenderer.setSize(window.innerWidth - 220, window.innerHeight);

  mainScene = new THREE.Scene();
  const light = new THREE.AmbientLight(0xffffff, 1);
  mainScene.add(light);

  mainCamera = new THREE.PerspectiveCamera(45, canvas.clientWidth / canvas.clientHeight, 0.1, 2000);
  mainCamera.position.set(0, 150, 300);

  mainControls = new THREE.OrbitControls(mainCamera, canvas);
  mainControls.enableDamping = true;

  animateMain();
}

function animateMain() {
  requestAnimationFrame(animateMain);
  if (mainControls) mainControls.update();
  mainRenderer.render(mainScene, mainCamera);
}

function loadMainModel(filename) {
  const loader = new THREE.GLTFLoader();
  loader.load(filename, gltf => {
    if (mainModel) mainScene.remove(mainModel);
    mainModel = gltf.scene;
    mainScene.add(mainModel);
  });
}

/* ===========================
   COMPARE MODE
   =========================== */

const compareBtn = document.getElementById("compare-btn");
const compareWrapper = document.getElementById("compare-wrapper");
const compareBack = document.getElementById("compare-back");

/* left + right canvases */
let rendererL, rendererR;
let sceneL, sceneR;
let camL, camR;
let controlsL, controlsR;

let modelLeft, modelRight;

/* build year selector in compare mode */
function buildCompareLists() {
  const L = document.getElementById("left-list");
  const R = document.getElementById("right-list");
  L.innerHTML = "";
  R.innerHTML = "";

  MODELS.forEach(file => {
    const y = file.replace(".glb", "");

    let btnL = document.createElement("button");
    btnL.textContent = y;
    btnL.onclick = () => loadLeftModel(file);
    L.appendChild(btnL);

    let btnR = document.createElement("button");
    btnR.textContent = y;
    btnR.onclick = () => loadRightModel(file);
    R.appendChild(btnR);
  });
}

compareBtn.onclick = () => {
  compareWrapper.style.display = "block";
  buildCompareLists();
  initCompareView();

  loadLeftModel(MODELS[0]);
  loadRightModel(MODELS[MODELS.length - 1]);
};

compareBack.onclick = () => {
  compareWrapper.style.display = "none";
};

/* initialize compare renderers */
function initCompareView() {
  const cL = document.getElementById("canvas-left");
  const cR = document.getElementById("canvas-right");

  rendererL = new THREE.WebGLRenderer({ canvas: cL, antialias: true });
  rendererR = new THREE.WebGLRenderer({ canvas: cR, antialias: true });

  const W = window.innerWidth - 220;
  const H = window.innerHeight;
  rendererL.setSize(W, H);
  rendererR.setSize(W, H);

  sceneL = new THREE.Scene();
  sceneR = new THREE.Scene();

  const lightL = new THREE.AmbientLight(0xffffff, 1);
  const lightR = new THREE.AmbientLight(0xffffff, 1);
  sceneL.add(lightL);
  sceneR.add(lightR);

  camL = new THREE.PerspectiveCamera(45, W/H, 0.1, 2000);
  camR = new THREE.PerspectiveCamera(45, W/H, 0.1, 2000);
  camL.position.set(0,150,300);
  camR.position.set(0,150,300);

  controlsL = new THREE.OrbitControls(camL, cL);
  controlsR = new THREE.OrbitControls(camR, cR);

  controlsR.enabled = false; // only LEFT is user-controlled

  animateCompare();

  // SYNC CAMERA
  controlsL.addEventListener("change", () => {
    camR.position.copy(camL.position);
    camR.rotation.copy(camL.rotation);
    camR.zoom = camL.zoom;
    camR.updateProjectionMatrix();
  });
}

/* load models */
function loadLeftModel(file) {
  const loader = new THREE.GLTFLoader();
  loader.load(file, gltf => {
    if (modelLeft) sceneL.remove(modelLeft);
    modelLeft = gltf.scene;
    sceneL.add(modelLeft);
  });
}

function loadRightModel(file) {
  const loader = new THREE.GLTFLoader();
  loader.load(file, gltf => {
    if (modelRight) sceneR.remove(modelRight);
    modelRight = gltf.scene;
    sceneR.add(modelRight);
  });
}

/* compare animation loop */
function animateCompare() {
  requestAnimationFrame(animateCompare);
  if (controlsL) controlsL.update();
  rendererL.render(sceneL, camL);
  rendererR.render(sceneR, camR);
}

/* ===========================
   SLIDER CONTROL
   =========================== */
const slider = document.getElementById("compare-slider");
let dragging = false;

slider.onmousedown = () => dragging = true;
window.onmouseup = () => dragging = false;

window.onmousemove = e => {
  if (!dragging) return;
  const W = window.innerWidth - 220;
  const x = Math.min(Math.max(e.clientX - 220, 10), W - 10);
  slider.style.left = (x + 220) + "px";

  const pct = x / W;

  const canvasL = document.getElementById("canvas-left");
  const canvasR = document.getElementById("canvas-right");

  canvasL.style.clipPath = `inset(0 ${(1-pct)*100}% 0 0)`;
  canvasR.style.clipPath = `inset(0 0 0 ${pct*100}%)`;
};
</script>

</body>
</html>
