<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8" />
<title>3D Modellvergleich</title>

<!-- model-viewer -->
<script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>

<style>
  :root {
    --sidebar-width: 220px;
    --accent: #0077ff;
  }

  html,body{
    height:100%;
    margin:0;
    font-family: Arial, sans-serif;
    background: #f6f6f6;
  }

  /* SIDEBAR */
  #sidebar{
    position:fixed;
    left:0;
    top:0;
    bottom:0;
    width:var(--sidebar-width);
    padding:20px;
    box-sizing:border-box;
    background:#1e1e1e;
    color:white;
    overflow:auto;
    z-index:50;
  }

  #sidebar h2 { margin:0 0 12px 0; font-size:18px; }
  .year-btn{
    display:block;
    width:100%;
    padding:10px;
    margin:8px 0;
    background:#333;
    color:white;
    border:0;
    border-radius:6px;
    cursor:pointer;
    text-align:left;
    font-size:15px;
  }
  .year-btn:hover{ background:#444; }

  #compare-btn {
    margin-top:18px;
    display:block;
    width:100%;
    padding:12px;
    background:var(--accent);
    color:white;
    border:0;
    border-radius:8px;
    cursor:pointer;
    font-weight:600;
    font-size:15px;
  }
  #compare-btn:hover{ filter:brightness(.95); }

  /* MAIN VIEW */
  #main-area{
    position:fixed;
    left:var(--sidebar-width);
    top:0;
    right:0;
    bottom:0;
    display:flex;
    align-items:center;
    justify-content:center;
    background:#eaeaea;
  }

  model-viewer#main-model{
    width:80%;
    height:80%;
    --poster-color: transparent;
  }

  /* COMPARE MODE */
  #compare-wrapper{
    display:none;
    position:fixed;
    left:var(--sidebar-width);
    top:0;
    width:calc(100vw - var(--sidebar-width));
    height:100vh;
    background:white;
    z-index:1000;
    overflow:hidden;
  }

  #compare-back {
    position:absolute;
    top:16px;
    left:16px;
    z-index:2000;
    padding:10px 14px;
    background:#000;
    color:#fff;
    border:0;
    border-radius:6px;
    cursor:pointer;
  }

  .side-list {
    position:absolute;
    top:50%;
    transform:translateY(-50%);
    display:flex;
    flex-direction:column;
    gap:10px;
    z-index:2000;
    width:160px;
  }
  #left-list { left:20px; }
  #right-list { right:20px; text-align:right; }

  .side-list button {
    padding:8px 10px;
    background:#222;
    color:#fff;
    border:0;
    border-radius:6px;
    cursor:pointer;
  }

  #compare-container{
    position:absolute;
    inset:0;
    overflow:hidden;
  }

  model-viewer.compare-model {
    position:absolute;
    inset:0;
    width:100%;
    height:100%;
    --poster-color: transparent;
    pointer-events:auto;
  }

  /* Initial half clipping */
  #model-left  { clip-path: inset(0 50% 0 0); }
  #model-right { clip-path: inset(0 0 0 50%); }

  #compare-slider {
    position:absolute;
    top:0;
    height:100%;
    width:6px;
    background:#ff3b3b;
    left:50%;
    transform:translateX(-3px);
    cursor:ew-resize;
    z-index:1500;
    border-radius:3px;
  }

  model-viewer::part(default-controls){
    display:none !important;
  }
</style>
</head>
<body>

  <!-- Sidebar -->
  <div id="sidebar">
    <h2>Modelle</h2>
    <div id="year-list"></div>
    <button id="compare-btn">Vergleichen</button>
  </div>

  <!-- Main Model -->
  <div id="main-area">
    <model-viewer id="main-model"
      camera-controls
      interaction-prompt="none">
    </model-viewer>
  </div>

  <!-- Compare Mode -->
  <div id="compare-wrapper">
    <button id="compare-back">← Zurück</button>

    <div id="left-list" class="side-list"></div>
    <div id="right-list" class="side-list"></div>

    <div id="compare-container">
      <model-viewer id="model-left" class="compare-model" camera-controls></model-viewer>
      <model-viewer id="model-right" class="compare-model" camera-controls></model-viewer>
    </div>

    <div id="compare-slider"></div>
  </div>

<script>
/* Models */
const MODEL_LIST = [
  "1150.glb",
  "1175.glb",
  "1374.glb",
  "1550.glb",
  "1630.glb",
  "1936.glb"
];

/* Fill year buttons */
const yearList = document.getElementById("year-list");
MODEL_LIST.forEach(fn => {
  const b = document.createElement("button");
  b.className = "year-btn";
  b.textContent = fn.replace(".glb", "");
  b.onclick = () => mainModel.src = fn;
  yearList.appendChild(b);
});

const mainModel = document.getElementById("main-model");
mainModel.src = MODEL_LIST[0];

/* Compare elements */
const modelLeft = document.getElementById("model-left");
const modelRight = document.getElementById("model-right");
const slider = document.getElementById("compare-slider");
const compareWrapper = document.getElementById("compare-wrapper");
const compareContainer = document.getElementById("compare-container");

/* Build compare lists */
function buildCompareLists() {
  leftList.innerHTML = "";
  rightList.innerHTML = "";
  MODEL_LIST.forEach(fn => {
    const name = fn.replace(".glb", "");
    const bl = document.createElement("button");
    bl.textContent = name;
    bl.onclick = () => modelLeft.src = fn;
    leftList.appendChild(bl);

    const br = document.createElement("button");
    br.textContent = name;
    br.onclick = () => modelRight.src = fn;
    rightList.appendChild(br);
  });
}

compareBtn.onclick = () => {
  compareWrapper.style.display = "block";
  buildCompareLists();
  if (!modelLeft.src) modelLeft.src = MODEL_LIST[0];
  if (!modelRight.src) modelRight.src = MODEL_LIST[1];
};

/* BACK button */
compareBack.onclick = () => {
  compareWrapper.style.display = "none";
};

/* Slider logic */
function updateClip(x) {
  const rect = compareContainer.getBoundingClientRect();
  const width = rect.width;

  const pos = Math.min(Math.max(x - rect.left, 0), width);

  slider.style.left = pos + "px";

  modelLeft.style.clipPath  = `inset(0 ${width - pos}px 0 0)`;
  modelRight.style.clipPath = `inset(0 0 0 ${pos}px)`;
}

slider.onmousedown = e => {
  const move = ev => updateClip(ev.clientX);
  const up = () => {
    window.removeEventListener("mousemove", move);
    window.removeEventListener("mouseup", up);
  };
  window.addEventListener("mousemove", move);
  window.addEventListener("mouseup", up);
};

/* Camera sync */
let lockedModel = null;
let syncing = false;

function syncCam(a, b) {
  if (syncing) return;
  syncing = true;
  b.cameraOrbit = a.cameraOrbit;
  b.cameraTarget = a.cameraTarget;
  b.fieldOfView = a.fieldOfView;
  setTimeout(() => syncing = false, 0);
}

/* Detect which model user is controlling */
function setActive(model) {
  lockedModel = model;
}

["mousedown","touchstart"].forEach(evt=>{
  modelLeft.addEventListener(evt,()=>setActive(modelLeft));
  modelRight.addEventListener(evt,()=>setActive(modelRight));
});

/* Sync from active model */
modelLeft.addEventListener("camera-change",()=>{
  if (lockedModel===modelLeft) syncCam(modelLeft,modelRight);
});
modelRight.addEventListener("camera-change",()=>{
  if (lockedModel===modelRight) syncCam(modelRight,modelLeft);
});

/* Initial center slider */
window.onload = () => {
  const rect = compareContainer.getBoundingClientRect();
  updateClip(rect.width/2);
};
</script>
</body>
</html>
